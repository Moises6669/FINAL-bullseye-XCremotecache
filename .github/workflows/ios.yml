name: ios-312
on:
  pull_request:
  workflow_dispatch:

jobs:
  build-macos:
      runs-on: macos
      steps: 
        - name: Pruebas
          run: |
            set -uo pipefail
            if [[ -f "../output/scan/report.junit" ]]; then
            echo "Uploading report.junit file to XRay"
            project_key="FNDMA"
            token=$(curl -H "Content-Type: application/json" -X POST --data '{"client_id":"CD075895727E4E5DAFD5FCC1FE7A78BF","client_secret":"65344aaa49d1a15ff9f0d1c2353e1b80f6bba5b410c18f263e655ad8daf5ac23"}' https://xray.cloud.getxray.app/api/v2/authenticate | tr -d '"')
            curl -H "Content-Type: text/xml" -X POST -H "Authorization: Bearer $token" --data @"../output/scan/report.junit" https://xray.cloud.getxray.app/api/v2/import/execution/junit?projectKey="$project_key" >"../xray_response.json"
            echo 'hello from Jira'
            else
            echo "File report.junit not found"
            fi
#       - name: Checkout
#         uses: actions/checkout@v2
#         with:
#            repository: "WW-Digital/WWKraken"
#            ref: develop
#            ssh-key: ${{ secrets.ssh_ww }}

#       - name: Install dependencies in Gemfile
#         run: bundle install

#       - name: Set up ENV variables, and .env file for cocoapods-keys
#         run: |
#           git clone git@github.com:WW-Digital/ios-common-config.git
#           touch .bash_env
#           export BASH_ENV="$GITHUB_WORKSPACE/.bash_env"
#           bash ./ios-common-config/circleci/fetch-keys.sh WWMobile .
#         env:
#           TRIGGER_OIDC_CURL_USER: ${{ secrets.TRIGGER_OIDC_CURL_USER }}
#           TRIGGER_OIDC_CURL_PASSWORD: ${{ secrets.TRIGGER_OIDC_CURL_PASSWORD }}
#           TRIGGER_OIDC_CURL_SERVICE_ACCOUNT: ${{ secrets.TRIGGER_OIDC_CURL_SERVICE_ACCOUNT }}

#       - name: Install dependencies in Podfile
#         run: |
#           source "$GITHUB_WORKSPACE/.bash_env"
#           bundle exec pod update
      
#       - name: Build macOS target
#         run: |
#           bundle exec fastlane mac build_mac_ci skip_notarization:true
#         env:
#           MATCH_PASSWORD: ${{ secrets.MATCH_PASSWORD }}
  
#   build-ios:
#       runs-on: macos 
#       steps: 
#        - name: Checkout
#          uses: actions/checkout@v2
#          with:
#              repository: "WW-Digital/WWKraken"
#              ref: develop
#              ssh-key: ${{ secrets.ssh_ww }}

#        - name: Install dependencies in Gemfile
#          run: bundle install

#        - name: Set up ENV variables, and .env file for cocoapods-keys
#          run: |
#             git clone git@github.com:WW-Digital/ios-common-config.git
#             touch .bash_env
#             export BASH_ENV="$GITHUB_WORKSPACE/.bash_env"
#             bash ./ios-common-config/circleci/fetch-keys.sh WWMobile .
#          env:
#             TRIGGER_OIDC_CURL_USER: ${{ secrets.TRIGGER_OIDC_CURL_USER }}
#             TRIGGER_OIDC_CURL_PASSWORD: ${{ secrets.TRIGGER_OIDC_CURL_PASSWORD }}
#             TRIGGER_OIDC_CURL_SERVICE_ACCOUNT: ${{ secrets.TRIGGER_OIDC_CURL_SERVICE_ACCOUNT }}

#        - name: Install dependencies in Podfile
#          run: |
#             source "$GITHUB_WORKSPACE/.bash_env"
#             bundle exec pod update
       
#        - name: Build iOS target
#          run: |
#           bundle exec fastlane ios build_ios_ci
#          env:
#           MATCH_PASSWORD: ${{ secrets.MATCH_PASSWORD }}
